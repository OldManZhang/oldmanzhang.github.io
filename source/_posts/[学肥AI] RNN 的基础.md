---
title: RNN çš„åŸºç¡€
date: 2024-08-06 10:18:38
tags: 
    - å­¦è‚¥AI
    - æ·±åº¦å­¦ä¹ 
    - RNN
    - CNN
    - NN
    - å·ç§¯ç¥ç»ç½‘ç»œ
categories: å­¦è‚¥AI
description: "æˆ‘ä»¬æœ‰æ—¶å€™éœ€è¦å¤„ç†ä¸€äº› æ—¶é—´åºåˆ—æ•°æ®ï¼Œæ¯”å¦‚ è‚¡ç¥¨é¢„æµ‹ï¼Œå¤©æ°”é¢„æµ‹ï¼Œæ ¹æ®å‰é¢å•è¯é¢„æµ‹åç»­ä¸€ä¸ªå•è¯ç­‰åœºæ™¯ã€‚NNï¼ˆNeural Networkï¼‰ åœ¨å¤„ç†è¿™äº›é—®é¢˜ï¼Œæœ‰ä»–çš„å±€é™æ€§ã€‚RNN ï¼ˆRecurrent Neural Networkï¼‰ï¼Œå°±æ˜¯ä¸ºäº†ç”¨äºå¤„ç†è¿™äº›é—®é¢˜ã€‚"
cover: https://qiniu.oldzhangtech.com/cover/%E5%A4%A7%E8%B0%B7%E7%BF%94%E5%B9%B3%202.jpg
---

## èƒŒæ™¯é—®é¢˜
æˆ‘ä»¬æœ‰æ—¶å€™éœ€è¦å¤„ç†ä¸€äº› _æ—¶é—´åºåˆ—æ•°æ®_ï¼Œæ¯”å¦‚ è‚¡ç¥¨é¢„æµ‹ï¼Œå¤©æ°”é¢„æµ‹ï¼Œæ ¹æ®å‰é¢å•è¯é¢„æµ‹åç»­ä¸€ä¸ªå•è¯ç­‰åœºæ™¯ã€‚NNï¼ˆNeural Networkï¼‰ åœ¨å¤„ç†è¿™äº›é—®é¢˜ï¼Œæœ‰ä»–çš„å±€é™æ€§ã€‚RNN ï¼ˆRecurrent Neural Networkï¼‰ï¼Œå°±æ˜¯ä¸ºäº†ç”¨äºå¤„ç†è¿™äº›é—®é¢˜ã€‚

## åŸç†
ä¸€å¥è¯ï¼šèƒ½å¤Ÿè®°ä½å‰ X æ­¥ï¼Œç¦»å½“å‰æ—¶é—´è¶Šè¿‘çš„ï¼Œè¶Šè®°å¾—æ·±åˆ»ï¼Œå³è¶Šèƒ½å½±å“å½“å‰æ­¥çš„è¾“å‡ºã€‚

é‡Œé¢æœ‰å‡ å±‚æ„æ€ï¼š

1. å½“å‰æ­¥è¾“å‡ºï¼Œä¸å‰ X æ­¥çš„è®°å¿†æ„æˆ
2. å‰ X æ­¥çš„è¾“å…¥ï¼Œå°±æ„æˆäº† å‰ X æ­¥çš„è®°å¿†
3. å‰ X æ­¥çš„è®°å¿†ï¼ŒX è¶Šå°ï¼Œæƒé‡è¶Šå¤§ï¼Œè¶Šèƒ½å½±å“å½“å‰æ­¥çš„è¾“å‡º

å’Œäººçš„è®°å¿†å°±å¾ˆåƒï¼Œè¶Šè¿‘çš„äº‹ä»¶ï¼Œå½“ç„¶è®°å¾—è¶Šæ¸…äº†ï¼Œè¶Šå¾€å‰å€’ï¼Œå°±è®°å¾—è¶Šæ¨¡ç³Šã€‚

ç®€å•çš„ç¤ºæ„å›¾ï¼Œé¢œè‰²è¶Šçº¢ï¼Œå°±æ˜¯è®°å¾—è¶Šæ¸…æ¥šçš„ã€‚è¶Šå¾€åï¼Œ`â€œwhatâ€` è¿™ä¸ªå•è¯å°±å·²ç»ä¸è®°å¾—äº†ã€‚
![](https://qiniu.oldzhangtech.com/mdpic/d972ff24-a2e9-4c69-b9f2-c13898cbba5d_f74254d1-fcc7-4ab7-a678-a74fa78fd7ee.png)

ğŸ’¡ æ‰€ä»¥ææ¸…æ¸…æ¥š **è®°å¿†**ï¼Œ**è¾“å…¥**ï¼Œ**è¾“å‡º**ï¼Œ**æ—¶é—´æ­¥** ä¹‹é—´çš„å…³ç³»ï¼Œæ˜¯ RNN çš„å…³é”®ã€‚ï¼ˆNN å°±æ²¡æœ‰ **è®°å¿†** å’Œ **æ—¶é—´æ­¥** çš„æ¦‚å¿µï¼‰

æ—¶é—´æ­¥ï¼Œå°±æ˜¯è¡¨ç¤ºæ—¶é—´åºåˆ—ã€‚æ¯”å¦‚ è‚¡å¸‚æŒ‡æ ‡çš„æ¯ç§’é’Ÿæ—¶åˆ»ï¼Œå¤©æ°”æµ®åŠ¨çš„æ¯å¤©æ—¶åˆ»ï¼Œä¸€å¥è¯ä¸­çš„æ¯ä¸ªå•è¯çš„å‰åé¡ºåºæ—¶åˆ»ï¼Œä»–ä»¬éƒ½æ˜¯æœ‰å…ˆåå…³ç³»çš„ã€‚
è®°å¿†ï¼Œå°±å¥½åƒ **æ¯ä¸ªæ—¶é—´æ­¥ **çš„ä¸€ä¸ªå†…å­˜ï¼Œä»–è®°å½•ç€å½“å‰æ­¥çš„ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´åŠ ä¸“ä¸šçš„ **éšçŠ¶æ€ï¼ˆHidden Stateï¼‰**æ¥è¡¨ç¤ºã€‚ä»–éšç€æ—¶é—´æ­¥çš„é€’è¿›ï¼Œé‡Œé¢ä¿å­˜çš„æ¶ˆæ¯æ…¢æ…¢å¼±åŒ–ï¼Œç›´è‡³æ¶ˆå¤±ã€‚

### åŸç†å›¾
###   ![](https://qiniu.oldzhangtech.com/mdpic/c332685c-2b24-4bba-a779-05fd81b85263_01dd4e9d-5ea6-446b-b12b-b23e191501f3.png)
ä¸Šè¿°æ˜¯ RNN çš„åŸç†å›¾ã€‚
h: æ˜¯éšçŠ¶æ€ï¼Œx: æ˜¯è¾“å…¥ï¼Œo: æ˜¯è¾“å‡ºï¼Œ ä¸Šé¢ 3 ä¸ªå˜é‡éƒ½æ˜¯ä¸æ—¶é—´æ­¥ç›¸å…³çš„ï¼Œæœ‰æ—¶é—´æ ‡æ³¨ã€‚
å›¾ä¸­çš„æ„æ€æ˜¯ï¼š t æ—¶åˆ»çš„ hï¼ˆéšçŠ¶æ€ï¼‰ï¼Œç”± t-1 æ—¶åˆ»çš„ hï¼ˆéšçŠ¶æ€ï¼‰å’Œ t æ—¶åˆ»çš„ xï¼ˆè¾“å…¥ï¼‰ç”Ÿæˆï¼›t æ—¶åˆ»çš„ oï¼ˆè¾“å‡ºï¼‰ï¼Œç”± t æ—¶åˆ»çš„ hï¼ˆéšçŠ¶æ€ï¼‰ç”Ÿæˆã€‚

æ€»ç»“æˆä¸‹é¢çš„ä¸¤ä¸ªå…¬å¼:    
$h_t = f(x_t, h_{t-1})$   
$o_t = g(h_t)$   

å› ä¸º  åˆå¯ä»¥å±•å¼€æ¥ $[ h_{t-1} = f(x_{t-1}, h_{t-2})]$  ï¼Œä¸” $h_{t-2}$ ä¹ŸåŒæ ·å±•å¼€ï¼Œè¿™æ ·å»¶ç»­ä¸‹å»ï¼Œå°±å¯ä»¥æ— é™å±•å¼€ã€‚
å› ä¸ºç¡¬ä»¶é™åˆ¶å’Œè®¡ç®—é™åˆ¶ï¼Œæˆ‘ä»¬ä¼šæœ‰ æ—¶é—´æ­¥ sequence çš„æ¦‚å¿µï¼Œå°±æ˜¯å½“å‰æ­¥çš„é¢„æµ‹ï¼Œä»…ä»…æ˜¯ä¸å‰ n æ­¥çš„éšçŠ¶æ€ç›¸å…³ï¼Œn å°±æ˜¯ sequence çš„æ„æ€ã€‚
![image.png](https://qiniu.oldzhangtech.com/mdpic/7e01c973-ba9d-4ab3-bda4-0132910d5ff5_fedcb4a7-55ad-4e45-9454-c26bda653585.png)
æ¯”å¦‚ä¸Šå›¾ï¼Œ sequence = 4ï¼Œ é•¿æ–¹å½¢å°±æ˜¯ éšçŠ¶æ€ï¼Œé•¿åº¦å°±æ˜¯æƒé‡ï¼Œè¶Šå¾€å·¦è¾¹ï¼Œä»£è¡¨æ—¶é—´è¶Šä¹…è¿œï¼Œé•¿åº¦è¶ŠçŸ®ï¼ŒéšçŠ¶æ€çš„æƒé‡è¶Šä½ã€‚åé¢å°±ä¼šé€æ¸æ¶ˆå¤±ï¼Œæ‰€ä»¥ $h_{t-5}$  å¯¹ $h_{t}$  å°±ä¸ä¼šå†èµ·ä½œç”¨äº†ã€‚

æ•´ä½“çš„å…¬å¼éå¸¸çš„ç®€å•ï¼Œå¯ä»¥è®°ä½ï¼Œæˆ–è€…ä¸ç”¨è®°å¿†ï¼Œäº†è§£å¤§è‡´é€šä¿—çš„æ„æ€ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä¸‹é¢æ‰‹å†™ RNN çš„ç»„ä»¶å°±æŠŠä¸Šé¢çš„å…¬å¼ ç”¨ä»£ç å±•ç°å‡ºæ¥ã€‚

## æ‰‹å†™ RNN ç»„ä»¶
æ ¹æ®ä¸Šè¿°çš„è¯´æ˜ï¼Œå½¢æˆ **éšçŠ¶æ€**ï¼Œæ˜¯æ•´ä¸ª `RNN` çš„å…³é”®ã€‚æ‰‹åŠ¨å®ç° `RNN` ç»„ä»¶ï¼Œå°±èƒ½äº†è§£ä»–çš„å†…éƒ¨è¿è¡Œæœºåˆ¶æ˜¯ä»€ä¹ˆï¼Œåˆ©äºç†è§£ä»–çš„åŸç†ã€‚
> æ‰‹å†™ç»„ä»¶ æ˜¯ä¸ºäº†å¯¹ `RNN` ç†è§£æ›´åŠ æ·±å…¥ï¼Œåç»­éƒ½ä½¿ç”¨ `nn.RNN` å·²ç»å°è£…å¥½çš„æ–¹æ³•ï¼Œä¸å†ä½¿ç”¨æ‰‹å†™ RNNã€‚å¯è¿è¡Œ ipynb æ–‡ä»¶[é“¾æ¥](https://gitee.com/oldmanzhang/resource_machine_learning/blob/master/deep_learning/rnn_basic.ipynb)ã€‚


ä¸‹é¢æ˜¯æ¨¡æ‹Ÿæœ‰ 10 ä¸ªæ—¶åˆ»ï¼ˆ sequence å˜é‡ ï¼‰çš„è¾“å…¥æ•°æ®ï¼Œä» _è¾“å…¥_ å½¢æˆ _éšçŠ¶æ€_ï¼Œå¹¶ä¸”ä» _éšçŠ¶æ€_ ç”Ÿæˆ _è¾“å‡º_ çš„è¿‡ç¨‹ã€‚
```python
hidden_size = 20 # è®°å¿†ä½“çš„ç»´åº¦
input_size = 1 # è¾“å…¥ç‰¹å¾
output_size = 1 # è¾“å‡ºç‰¹å¾


# è¾“å…¥çš„æ˜ å°„å…³ç³»ï¼Œæ›´æ–° è®°å¿†ä½“çš„æ•°æ®
i2h = nn.Linear(input_size + hidden_size, hidden_size)  # è¾“å…¥åˆ°éšè—å±‚
# ä» è®°å¿†ä½“çš„æ•°æ® ç”Ÿæˆ è¾“å‡ºæ•°æ®
i2o = nn.Linear(hidden_size, output_size)  # éšè—å±‚åˆ°è¾“å‡ºå±‚

# åˆå§‹åŒ–ä¸€ä¸ªè¾“å…¥ï¼Œæ ¼å¼æ˜¯å°±æ˜¯ (sequence, input_feature)
sequence = 10
X = torch.rand(sequence,1)
# åˆå§‹åŒ–ä¸€ä¸ªè®°å¿†ä½“, sequence, feature
hidden = torch.zeros(len(X), hidden_size)

# [1] æ··åˆ è¾“å…¥ å’Œ å‰ä¸€ä¸ªè®°å¿†ä½“
combined = torch.cat((X, hidden), 1)  # torch.Size([1, 21])

# [2] å½¢æˆ æ–°çš„è®°å¿†ä½“
hidden = i2h(combined)
# [3] è¾“å‡º output
output = i2o(hidden)

# åç»­åŠ ä¸Š æŸå¤±å‡½æ•° å’Œ ä¼˜åŒ–å‡½æ•° å’Œ åå‘ä¼ æ’­ï¼Œå°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„ RNN çš„æµç¨‹ã€‚
 
```
ä¸Šè¿°å°±æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ RNN ç»„ä»¶çš„å®ç°é€»è¾‘ï¼Œä»£ç ç®€å•æ¸…æ™°ï¼Œå°±ä¸å†ä¸€å¥å¥è¯´æ˜ã€‚

æœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š

1. [1] + [2] å³æ˜¯  $f(x_t , h_{t-1})$ ï¼Œ  `torch.cat + i2h (full connect)` ï¼Œè¾“å‡º $h_t$`å½“å‰ hidden_state` ã€‚
2. [3] å³æ˜¯ $g(h_t)$ ï¼Œ `i2o (hidden)`ï¼Œè¾“å‡º $o_t$å½“å‰è¾“å‡ºï¼Œå°±æ˜¯ä» `å½“å‰hidden_state` ä¸­æ¥
3. ä¸Šè¿°ä»£ç æ•´åˆåˆ°ä¸€ä¸ª model é‡Œé¢ï¼Œå¾ªç¯èµ·æ¥ï¼Œå°±ä¼šæ˜¯ä¸€ä¸ªæ‰‹å†™ RNNã€‚
4. [1] ä¸­ï¼Œ`torch.cat((X, hidden), 1)` æ˜¯ `10 * input` å’Œ `hidden_state` æ··åˆå»ºç«‹è”ç³»ï¼›å½“ç„¶å¯ä»¥ $f(x_1, hidden_0)$; $f(x_2, hidden_1)$; $f(x_3, hidden_2)$ ... $f(x_10, hidden_9)$ é€æ­¥å †å  `hidden_state`ï¼Œè¿™æ ·ä¼šæ›´åŠ çš„ç›´è§‚ã€‚

## ä¾‹å­ - é¢„æµ‹å­—ç¬¦
ç›®çš„ï¼šç”±â€œ2 ä¸ªå­—ç¬¦â€ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼ŒåŒæ—¶è¿ç»­çŒœæµ‹ä¸‹å»ã€‚
è®­ç»ƒæ•°æ®ï¼š "hello world"ã€‚

**_åˆ†æè¿‡ç¨‹ï¼š_**

1. æ˜¯ **åˆ†ç±»**é—®é¢˜
2. â€œ2 ä¸ªå­—ç¬¦â€ æ˜¯ä¸€ä¸ªæœ‰è¿ç»­å…ˆåå…³ç³»çš„è¾“å…¥ï¼Œæ‰€ä»¥ä½¿ç”¨ RNN
3. å®šä¹‰ RNN çš„æ—¶å€™ input_feature å’Œ output_feature éƒ½æ˜¯ 8ï¼ˆå­—ç¬¦ä¸²çš„æ‰€æœ‰å”¯ä¸€å€¼æ€»æ•°æ˜¯ 8ï¼‰
4. X çš„ sequence å¯ä»¥å®šä¹‰æˆ 2 

è¯¦ç»†çš„ä»£ç å¯ä»¥ç›´æ¥è®¿é—® ipynb æ–‡ä»¶[é“¾æ¥](https://gitee.com/oldmanzhang/resource_machine_learning/blob/master/deep_learning/rnn_classifications_charPredit.ipynb)ã€‚
è®­ç»ƒåçš„ç»“æœï¼š
```python
# æµ‹è¯•æ¨¡å‹
start_str = "he"
predict_times = 5

###### output predict
# Predicted string: hello w
```

## ä¾‹å­ - é¢„æµ‹ GS10
ç›®çš„ï¼šç”±å‰ 6 å¹´æ•°æ®ï¼Œæ˜¯å¦å¯ä»¥é¢„æµ‹åˆ° ä¸‹ä¸€å¹´çš„æ•°æ®
è®­ç»ƒæ•°æ®ï¼š ç¾å›½å›½å€ºæ”¶ç›Šç‡æ•°æ®
**_åˆ†æè¿‡ç¨‹ï¼š_**

1. æ˜¯ **å›å½’**é—®é¢˜
2. â€œå‰ 6 å¹´æ•°æ®â€ é¢„æµ‹ä¸‹ä¸€å¹´ï¼Œå°±æ˜¯æœ‰ä¸€ä¸ªå…ˆåæ—¶é—´å…³ç³»ï¼Œæ‰€ä»¥ä½¿ç”¨ RNN
3. å®šä¹‰ RNN çš„æ—¶å€™ input_feature å’Œ output_feature éƒ½æ˜¯ 1ï¼ˆå› ä¸ºéƒ½æ˜¯ æ•°å€¼ä¸Šæ˜¯ 1 ä¸ªå€¼çš„å›å½’ï¼‰
4. X çš„ sequence å¯ä»¥å®šä¹‰æˆ 6

è¯¦ç»†çš„ä»£ç å¯ä»¥ç›´æ¥è®¿é—® ipynb æ–‡ä»¶[é“¾æ¥](https://gitee.com/oldmanzhang/resource_machine_learning/blob/master/deep_learning/rnn_regresssion_gs10.ipynb)ã€‚
è®­ç»ƒåçš„ç»“æœï¼š
![image.png](https://qiniu.oldzhangtech.com/mdpic/3cf5a41c-6742-4031-afe8-d7931e87970f_48c9e63a-60a4-4845-8333-f73de20a0504.png)


## ä»£ç æ³¨æ„é—®é¢˜
> é›†ä¸­åœ¨è°ƒç”¨ nn.RNN çš„é—®é¢˜

### nn.RNN çš„ input_feature å’Œ X ç»´åº¦å…³ç³»
åœ¨æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œè°ƒæ•´ `model(X)` ä¸­çš„ `X` ç»´åº¦ï¼Œæ˜¯æœ€è€—è´¹æ—¶é—´çš„ã€‚å¦‚æœè¯­æ„ä¸Šå»ç†è§£äº†ï¼Œé‚£ä¹ˆç”¨èµ·æ¥å°±ä¼šå¾—å¿ƒåº”æ‰‹å¾ˆå¤šã€‚

ğŸ”¥ æ³¨æ„ç‚¹

1. æ¯”å¦‚ï¼šä¸€ä¸ª X.shape = (5,3,10)ï¼Œå°±å¯ä»¥ç†è§£æˆ  **5 ä¸ªæ ·æœ¬, 3 ä¸ªæ—¶é—´æ­¥, æ¯ä¸ªæ—¶é—´æ­¥æœ‰ 10 ä¸ªç‰¹å¾**
2. `X dim` **è‡³å°‘æ˜¯ 2 ç»´**ï¼Œåˆ†åˆ«æ˜¯ `(sequence, feature)`; å¦‚æœæ˜¯ 3 ç»´ï¼Œåˆ†åˆ«æ˜¯ `(batch, sequence, feature)`ï¼›å½“ç„¶ ä¹Ÿå¯ä»¥å¤§äº 2 ç»´ã€‚

å¯è¿è¡Œæ–‡ä»¶[é“¾æ¥](https://gitee.com/oldmanzhang/resource_machine_learning/blob/master/deep_learning/rnn_basic.ipynb)

**åˆ†ç±»é—®é¢˜**, X.dim = 3
```python

import torch
import torch.nn as nn

# å®šä¹‰ RNN å±‚
# input_size ç†è§£æˆ ç‰¹å¾ä¼šæ¯”è¾ƒå¥½
rnn = nn.RNN(input_size=10, hidden_size=20, num_layers=1, batch_first=True)

# åˆ›å»ºè¾“å…¥å¼ é‡ (batch_size, seq_length, input_size)
input_tensor = torch.randn(5, 3, 10)  # 5 ä¸ªæ ·æœ¬, 3 ä¸ªæ—¶é—´æ­¥, æ¯ä¸ªæ—¶é—´æ­¥æœ‰ 10 ä¸ªç‰¹å¾

# åˆå§‹åŒ–éšè—çŠ¶æ€ (num_layers, batch_size, hidden_size)
h0 = torch.zeros(1, 5, 20)  # 1 å±‚, 5 ä¸ªæ ·æœ¬, æ¯å±‚éšè—çŠ¶æ€æœ‰ 20 ä¸ªç‰¹å¾

# æ‰§è¡Œå‰å‘ä¼ é€’
output, hn = rnn(input_tensor, h0)

# æ‰“å°è¾“å…¥å’Œè¾“å‡ºçš„å½¢çŠ¶
print("Input shape:", input_tensor.shape)
print("Output shape:", output.shape)
print("Hidden state shape:", hn.shape)
'''
Input shape: torch.Size([5, 3, 10])
Output shape: torch.Size([5, 3, 20])
Hidden state shape: torch.Size([1, 5, 20])
'''

```
åŒæ ·æ˜¯ rnn çš„ model, X.dim = 2ï¼Œä¸€æ ·å¯ä»¥è¿è¡Œï¼Œé‚£ä¹ˆä»–å°±ä»£è¡¨äº† (seq_length, input_size)
```python
# åˆ›å»ºè¾“å…¥å¼ é‡ (seq_length, input_size)
input_tensor = torch.randn(3, 10)  # 3 ä¸ªæ—¶é—´æ­¥, æ¯ä¸ªæ—¶é—´æ­¥æœ‰ 10 ä¸ªç‰¹å¾

# åˆå§‹åŒ–éšè—çŠ¶æ€ (num_layers, batch_size, hidden_size)
h0 = torch.zeros(1, 20)  # 1 å±‚, 5 ä¸ªæ ·æœ¬, æ¯å±‚éšè—çŠ¶æ€æœ‰ 20 ä¸ªç‰¹å¾

# æ‰§è¡Œå‰å‘ä¼ é€’
output, hn = rnn(input_tensor, h0)
print("Input shape:", input_tensor.shape)
print("Output shape:", output.shape)
print("Hidden state shape:", hn.shape)

'''
Input shape: torch.Size([3, 10])
Output shape: torch.Size([3, 20])
Hidden state shape: torch.Size([1, 20])
'''

```
**å›å½’é—®é¢˜**ï¼ŒX.dim = 3
```python
# å›å½’çš„æ—¶å€™ï¼ŒåŸºæœ¬ä¸Š 1 ä¸ªç‰¹å¾è¾“å…¥ï¼Œ1 ä¸ªç‰¹å¾è¾“å‡º
import torch
import torch.nn as nn

# å®šä¹‰ RNN å±‚
# input_size ç†è§£æˆ ç‰¹å¾ä¼šæ¯”è¾ƒå¥½
rnn = nn.RNN(input_size=1, hidden_size=20, num_layers=1, batch_first=True)

# åˆ›å»ºè¾“å…¥å¼ é‡ (batch_size, seq_length, input_size)
input_tensor = torch.randn(5, 3, 1)  # 5 ä¸ªæ ·æœ¬, 3 ä¸ªæ—¶é—´æ­¥, æ¯ä¸ªæ—¶é—´æ­¥æœ‰ 1 ä¸ªç‰¹å¾

# åˆå§‹åŒ–éšè—çŠ¶æ€ (num_layers, batch_size, hidden_size)
h0 = torch.zeros(1, 5, 20)  # 1 å±‚, 5 ä¸ªæ ·æœ¬, æ¯å±‚éšè—çŠ¶æ€æœ‰ 20 ä¸ªç‰¹å¾

# æ‰§è¡Œå‰å‘ä¼ é€’
output, hn = rnn(input_tensor, h0)

# æ‰“å°è¾“å…¥å’Œè¾“å‡ºçš„å½¢çŠ¶
print("Input shape:", input_tensor.shape)
print("Output shape:", output.shape)
print("Hidden state shape:", hn.shape)

'''
Input shape: torch.Size([5, 3, 1])
Output shape: torch.Size([5, 3, 20])
Hidden state shape: torch.Size([1, 5, 20])
'''
```
è¿™é‡Œçš„ output éœ€è¦ç»è¿‡ä¸€ä¸ªå…¨è¿æ¥å±‚ï¼Œæ‰æœ€åè½¬æ¢æˆçœŸæ­£çš„ outputã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼Œåˆ©ç”¨ä¸Šé¢çš„å›å½’ä¾‹å­ï¼Œæ¨¡æ‹Ÿ output_size =1 è¿›è¡Œè¾“å‡ºã€‚
```python
#å› ä¸º RNN å±‚æ˜¯æ²¡æœ‰ output_size,æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ªç”¨äº output_sizeï¼Œæ¯”å¦‚å›å½’è¾“å‡º 1 ä¸ªç‰¹å¾

# 20ä¸ªç‰¹å¾é‡Œé¢ï¼Œæå–ä¸€ä¸ªè¾“å‡º
out_linear = nn.Linear(in_features=20, out_features=1)
output2 = out_linear(output)
print("Output shape:", output2.shape)

# ä¸ input å¯¹åº”èµ·æ¥äº†ï¼Œå°±æ˜¯ # 5 ä¸ªæ ·æœ¬, 3 ä¸ªæ—¶é—´æ­¥, æ¯ä¸ªæ—¶é—´æ­¥æœ‰ 1 ä¸ªç‰¹å¾
'''
Output shape: torch.Size([5, 3, 1])
'''

```

### nn.RNN çš„  target ä¸ y çš„æ•°æ®çš„å¤„ç†
è¿˜æ˜¯ä¸Šè¿°çš„ä¾‹å­ï¼Œå›å½’é—®é¢˜
```python
# å›å½’çš„æ—¶å€™ï¼ŒåŸºæœ¬ä¸Š 1 ä¸ªç‰¹å¾è¾“å…¥ï¼Œ1 ä¸ªç‰¹å¾è¾“å‡º
import torch
import torch.nn as nn

# å®šä¹‰ RNN å±‚
# input_size ç†è§£æˆ ç‰¹å¾ä¼šæ¯”è¾ƒå¥½
rnn = nn.RNN(input_size=1, hidden_size=20, num_layers=1, batch_first=True)

# åˆ›å»ºè¾“å…¥å¼ é‡ (batch_size, seq_length, input_size)
input_tensor = torch.randn(5, 3, 1)  # 5 ä¸ªæ ·æœ¬, 3 ä¸ªæ—¶é—´æ­¥, æ¯ä¸ªæ—¶é—´æ­¥æœ‰ 1 ä¸ªç‰¹å¾

# åˆå§‹åŒ–éšè—çŠ¶æ€ (num_layers, batch_size, hidden_size)
h0 = torch.zeros(1, 5, 20)  # 1 å±‚, 5 ä¸ªæ ·æœ¬, æ¯å±‚éšè—çŠ¶æ€æœ‰ 20 ä¸ªç‰¹å¾

# æ‰§è¡Œå‰å‘ä¼ é€’
output, hn = rnn(input_tensor, h0)

# æ‰“å°è¾“å…¥å’Œè¾“å‡ºçš„å½¢çŠ¶
print("Input shape:", input_tensor.shape)
print("Output shape:", output.shape)
print("Hidden state shape:", hn.shape)
'''
Input shape: torch.Size([5, 3, 1])
Output shape: torch.Size([5, 3, 20])
Hidden state shape: torch.Size([1, 5, 20])
'''


#å› ä¸º RNN å±‚æ˜¯æ²¡æœ‰ output_size,æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ªç”¨äº output_sizeï¼Œæ¯”å¦‚å›å½’è¾“å‡º 1 ä¸ªç‰¹å¾

# 20ä¸ªç‰¹å¾é‡Œé¢ï¼Œæå–ä¸€ä¸ªè¾“å‡º
out_linear = nn.Linear(in_features=20, out_features=1)
output2 = out_linear(output)
print("Output shape:", output2.shape)

# ä¸ input å¯¹åº”èµ·æ¥äº†ï¼Œå°±æ˜¯ # 5 ä¸ªæ ·æœ¬, 3 ä¸ªæ—¶é—´æ­¥, æ¯ä¸ªæ—¶é—´æ­¥æœ‰ 1 ä¸ªç‰¹å¾
'''
Output shape: torch.Size([5, 3, 1])
'''
```
å› ä¸ºè®­ç»ƒæ•°æ® X.shape = torch.Size([5, 3, 1]) `5 ä¸ªæ ·æœ¬, 3 ä¸ªæ—¶é—´æ­¥, æ¯ä¸ªæ—¶é—´æ­¥æœ‰ 1 ä¸ªç‰¹å¾`ï¼Œå¾—åˆ° output éƒ½æ˜¯ shape ä¸ X ä¸€è‡´ï¼Œéƒ½æ˜¯ torch.Size([5, 3, 1])ã€‚ ä½†æ˜¯æˆ‘ä»¬ä»…ä»…æ˜¯éœ€è¦ **æœ€åæ—¶é—´æ­¥** çš„æ•°æ®ï¼Œæ‰æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ï¼Œå³ output[:, -1, :] å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ã€‚

```python
#å› ä¸º RNN å±‚æ˜¯æ²¡æœ‰ output_size,æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ªç”¨äº output_sizeï¼Œæ¯”å¦‚å›å½’è¾“å‡º 1 ä¸ªç‰¹å¾

# 20ä¸ªç‰¹å¾é‡Œé¢ï¼Œæå–ä¸€ä¸ªè¾“å‡º
out_linear = nn.Linear(in_features=20, out_features=1)
output2 = out_linear(output[:,-1,:])
print("Output shape:", output2.shape)

# ä¸ input å¯¹åº”èµ·æ¥äº†ï¼Œå°±æ˜¯ # 5 ä¸ªæ ·æœ¬, 3 ä¸ªæ—¶é—´æ­¥, æ¯ä¸ªæ—¶é—´æ­¥æœ‰ 1 ä¸ªç‰¹å¾
'''
Output shape: torch.Size([5, 1])
'''
```
`output[:, -1, :]` å– æœ€åæ—¶é—´æ­¥ çš„æ•°æ®ã€‚è¿™æ˜¯ä¸€ç§å–å·§çš„æ–¹æ³•ã€‚

ä½†æ˜¯æœ‰æ—¶å€™ï¼Œä»–å¹¶ä¸æ˜¯è¾“å‡ºæœ€åæ—¶é—´æ­¥çš„æ•°æ®ï¼Œæ‰€ä»¥è®°å¾—ç•™æ„æ„å»º targetï¼ˆçœŸå®å€¼ï¼‰ çš„æ—¶å€™ï¼Œæ³¨æ„æ˜¯å¦ä» model å‡ºæ¥çš„ yï¼ˆé¢„æµ‹å€¼ï¼‰ çš„ç»´åº¦ä¹‹é—´çš„å·®å¼‚ã€‚
## æ€»ç»“
### éšçŠ¶æ€
ä»–æ˜¯ä¸€ä¸ªä¸­é—´çŠ¶æ€ï¼Œä»‹äºè¾“å…¥å’Œè¾“å‡ºä¹‹é—´ï¼Œæˆ–è€…è¯´è®°å¿†åŠ›ï¼Œä»–æ˜¯ RNN çš„ä¸€ä¸ªå…³é”®æ¦‚å¿µã€‚
ä»–åœ¨åç»­çš„ decode&encode çš„æ¨¡å‹ä¸­ï¼Œéƒ½å‘æŒ¥ç€é‡è¦çš„ä½œç”¨ã€‚
### ä¼˜ç‚¹å’Œåœºæ™¯
åºåˆ—æ•°æ®çš„ä»»åŠ¡é€‚åˆä½¿ç”¨ RNNã€‚

1. è‚¡ç¥¨é¢„æµ‹
2. è‡ªç„¶è¯­è¨€å¤„ç†
### ç¼ºç‚¹

1. æ—¶é—´æ­¥è¿‡é•¿ï¼Œä¼šå¯¼è‡´å‰é¢çš„éšçŠ¶æ€ä¼šç»™å¿˜è®°äº†
2. æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸
3. è®¡ç®—æ•ˆç‡ç›¸å¯¹æ¯”è¾ƒä½
## 
