---
title: 微信云开发及云函数
date: 2024-11-07 10:18:38
tags: 
    - 微信
    - 微信云开发
    - 云开发
    - 云函数
    - 云数据库
    - 云存储
categories: 微信云开发
description: "如果微信小程序是前端，那么后端就是 服务器/后端代码运行/云存储/数据库等，前后端配合才是一个完整的面向服务的程序。

前后端配置，上述是正常的开发的组合。但是后端涉及到很多繁琐的步骤，比如 域名申请/域名解析/后端代码部署...一系列的问题。等解决好这些问题，时间都耗费了半天了。

微信云开发，就是为了解决上述的问题。在 **微信开发者工具** 中就可以一键开发 **数据库/云函数/云存储**，方便灵活。"
cover:  https://images.unsplash.com/photo-1685115755599-c47f5a54db76?q=80&w=2231&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D
---


## 云开发是什么
如果微信小程序是前端，那么后端就是 服务器/后端代码运行/云存储/数据库等，前后端配合才是一个完整的面向服务的程序。

前后端配置，上述是正常的开发的组合。但是后端涉及到很多繁琐的步骤，比如 域名申请/域名解析/后端代码部署...一系列的问题。等解决好这些问题，时间都耗费了半天了。

微信云开发，就是为了解决上述的问题。在 **微信开发者工具** 中就可以一键开发 **数据库/云函数/云存储**，方便灵活。



相应的网站说明： [云开发 ](https://developers.weixin.qq.com/miniprogram/dev/wxcloudservice/wxcloud/guide/init.html)。下面就着 云函数，说明一下。



## 云函数 hello world
1. 新建一个 **云环境**，打开 _微信开发者工具_，点击 _云开发_ 按钮。

![](https://qiniu.oldzhangtech.com/mdpic/a3303d65-ae28-4a4a-b024-d00ad6ff4095_ff179b1c-7af2-4c3e-90a7-90529e880779.png)

![](https://qiniu.oldzhangtech.com/mdpic/55118c6e-7dd0-4378-aaad-398c8fa4f6f9_d3cdcadd-4568-4b51-81ad-2d66fe249616.png)

红色箭头是 `envId`，后续在代码中用上。暂时先建立一个环境 `test`。

> ❓环境是什么？
>
> 就是用来隔离不同 云函数/数据库/云存储的 空间。可以想象，不同的环境，就等于不同的房子；不同的房子里面虽然都有 桌子椅子，但是他们都是独立的。
>



2. 新建目录，`cloudfunctions` ，是云函数的保存目录。在项目根目录找到 `project.config.json` 文件，新增 `cloudfunctionRoot` 字段，`value` 就是 `cloudfunctions`。

```javascript
{
   "cloudfunctionRoot": "cloudfunctions/"
}
```

在 **新建的目录** 上要选择你要在 ` 哪个环境 ` 中进行开发云函数，比如下图，选择了 新建的 `test` 环境。

![](https://qiniu.oldzhangtech.com/mdpic/5bed85c0-d45a-4bc6-84b7-4b3601f05b1d_678f3efa-eef6-4d5d-94a6-f9f2acf75f09.png)



3. 创建云函数，在 `cloudfunctions` 目录 右键，点击 【新建 node.js 云函数】，名字叫 `add`。

![](https://qiniu.oldzhangtech.com/mdpic/1e29e888-7ffc-4c8e-ad45-9211e11c3688_6c840fc5-13f7-4e5e-b1c0-257e5525e4c3.png)

add 目录下 增加多 3 个文件

![](https://qiniu.oldzhangtech.com/mdpic/b062fd6a-be83-4b1f-adaa-abc4b1c445aa_55aae544-8c59-4f95-8fee-fa139fc5b325.png)



4. 修改 `add/index.js` ，全文替换成下面的代码。

```javascript

// 云函数入口函数
exports.main = async (event, context) => {
  // ...
  return {
    sum: event.a + event.b
  }
}
```



5. 修改 `package.json`， 删除 `dependencies` 里面的值，类似的代码如下

```javascript
"dependencies": {
    
  }
```



6. 上传函数，变成 `云`

![](https://qiniu.oldzhangtech.com/mdpic/8677fd70-f4e7-48dc-8151-500ce61fc6c5_2e030105-4f2e-4076-9e42-aa5d749a7d49.png)



> 如果，有以下的情况
>
> 1. `index.js` 中 **没有** `const cloud = require('wx-server-sdk')` 代码
> 2. `package.json` 的 `dependencies` 字段 没有值
>
> 就可以  点击【上传并部署: 所有文件】菜单，比如 本例。
>
> 如果有上述的情况，就可以  点击【上传并部署: 云端安装依赖】菜单。
>
> ![](https://qiniu.oldzhangtech.com/mdpic/beccdf18-d285-4e40-a6f3-1ab02736ce83_c349e39c-ec34-4d3a-9292-92cbc54a50e9.png)
>





> 💡 'wx-server-sdk' 的安装，是为了 云函数中可以 调用 **数据库** 和 **云存储**。如果你在微信小程序中是直接 调用 数据库 和 云存储，就没有必要在 云函数 中倒一倒了。
>



7. 调试云函数，在 **开发者工具** 就可以调试刚刚上传的云函数

![](https://qiniu.oldzhangtech.com/mdpic/1ae346b2-e450-4d10-b42a-c05843452c69_385b46fd-7871-4826-8fb7-348178fcd442.png)



8. 小程序中调用 云函数 add

```javascript
wx.cloud.init({
      env: 'test-safjlfjasdfasf'
    })

wx.cloud.callFunction({
      // 云函数名称
      name: 'add',
      // 传给云函数的参数
      data: {
        a: 1,
        b: 2,
      },
      success: function(res) {
        console.log(res.result.sum) // 3
      },
      fail: console.error
    })
```



9. 撒花

## 总结

_微信云开发_ 开发 _云函数_，可以在一个工具里面同时开发前端和后端的代码，减少繁琐的步骤，加快开发的效率。

